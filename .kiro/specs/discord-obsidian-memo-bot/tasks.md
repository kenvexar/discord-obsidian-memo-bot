# 実装計画

## 概要

この実装計画は、Discord-Obsidianメモボットを段階的に構築するためのタスクリストです。各タスクは独立して実行可能で、テスト駆動開発を重視し、段階的に機能を追加していきます。

## タスクリスト

- [x] 1. プロジェクト基盤とコア構造の設定
  - プロジェクト構造の作成、依存関係の設定、基本設定ファイルの作成
  - Discord.py、google-generativeai、python-garminconnectなどの必要なライブラリをインストール
  - 環境変数管理とログ設定の実装
  - _要件: 1.1, 11.6_

- [x] 2. Discord Bot基本機能の実装
  - Discord Botクライアントの初期化とイベントハンドラーの設定
  - 基本的なメッセージ監視機能の実装
  - チャンネル判定ロジックの実装（📝 INBOX/CAPTURE、💡 IDEAS/INSIGHTS、✅ TASKS/LOGSカテゴリ）
  - _要件: 1.1, 1.2, 1.3_

- [x] 3. メッセージ処理とメタデータ抽出
  - メッセージからタイムスタンプ、チャンネル情報の抽出
  - 添付ファイル検知機能の実装
  - 基本的なメッセージ構造化の実装
  - _要件: 1.4, 1.5_

- [x] 4. Gemini API統合とAI処理機能
  - Google Gemini APIクライアントの設定
  - テキスト要約機能の実装
  - キーワード抽出とタグ生成機能
  - カテゴリ分類機能の実装
  - _要件: 3.1, 3.2, 3.3_

- [x] 5. API使用量管理とエラーハンドリング
  - Gemini API使用量追跡システムの実装
  - API制限到達時のフォールバック処理
  - エラーハンドリングとリトライロジック
  - 使用量警告システム（80%到達時の通知）
  - _要件: 3.6, 10.1, 10.3_

- [x] 6. Obsidianファイル管理システム
  - Markdownファイル作成機能の実装
  - YAMLフロントマター生成機能
  - ファイル命名規則の実装（YYYYMMDDHHMM_タイトル.md）
  - フォルダ分類ロジック（00_Inbox/、02_DailyNotes/等）
  - _要件: 4.1, 4.2, 4.3, 4.6_

- [x] 7. デイリーノート統合機能
  - デイリーノート自動作成機能
  - #activity-logメッセージのデイリーノート追記
  - #daily-tasksメッセージのデイリーノート追記
  - セクション管理（## Activity Log、## Daily Tasks）
  - _要件: 4.4, 4.5_

- [x] 8. テンプレートシステムの実装
  - 99_Meta/フォルダからのテンプレート読み込み
  - プレースホルダー置換機能（AI生成データの埋め込み）
  - デイリーノートテンプレートの適用
  - アイデアノートテンプレートの適用
  - _要件: 7.1, 7.2, 7.3, 7.4_

- [x] 9. 音声メモ処理機能
  - すべての監視対象チャンネルでの音声ファイル検知
  - Google Cloud Speech-to-Text API統合
  - 音声→テキスト変換機能
  - チャンネル別の音声メモ処理ロジック
  - 音声認識API使用量追跡（月60分制限）
  - _要件: 2.1, 2.2, 2.3, 2.4, 2.6_

- [x] 10. 音声処理のフォールバック機能
  - 音声認識制限到達時の処理
  - 音声ファイルの05_Resources/保存機能
  - 手動変換用リンク生成
  - チャンネル別音声処理エラーハンドリング
  - _要件: 2.3, 2.5, 10.5_

- [x] 11. Garmin健康データ統合
  - python-garminconnectライブラリの統合
  - Garmin Connect認証システム
  - 健康データ取得機能（睡眠、歩数、心拍数、活動データ）
  - デイリーノートへの健康データ追記（## Health Dataセクション）
  - _要件: 8.1, 8.2, 8.3_

- [x] 12. 健康データのAI分析機能
  - Garminデータの要約と洞察生成（週1回制限）
  - 重要な変化検知システム
  - 健康データとDiscord活動ログの時系列統合
  - Garmin APIエラーハンドリング
  - _要件: 8.4, 8.5, 8.7_

- [x] 13. 高度なAI機能の実装
  - 既存ノートとの関連性分析
  - [[内部リンク]]提案機能
  - URL内容要約機能
  - 関連ノート検索システム
  - _要件: 3.4, 3.5_

- [x] 14. Discordコマンドシステム
  - /helpコマンドの実装（日本語対応）
  - /statusコマンドの実装（システム状態表示）
  - /searchコマンドの実装（Vault内検索）
  - /statsコマンドの実装（統計情報表示）
  - /random_noteコマンドの実装（ランダムノート表示）
  - _要件: 5.1, 5.2, 5.3, 5.4, 5.5_

- [x] 15. 通知とフィードバックシステム
  - 処理完了通知機能（Obsidianノートリンク付き）
  - エラー通知システム
  - #bot-notificationsチャンネルへの自動通知
  - システムイベントログ（起動、エラー復旧、制限警告）
  - _要件: 5.6, 5.7, 6.3, 11.7_

- [x] 16. 設定管理システム
  - チャンネル設定の動的更新機能
  - APIキー更新と検証機能
  - 設定変更の確認システム
  - 連携チャンネルの追加・削除機能
  - _要件: 6.1, 6.2, 6.5_

- [x] 17. 自動レビューと整理提案システム
  - 週次未整理メモ通知（毎週日曜日）
  - 月次活動サマリー生成（Gemini API使用）
  - 長期滞在メモのリマインダー（30日以上）
  - 関連メモ統合提案（ルールベース分析）
  - トピック別分類提案システム
  - _要件: 9.1, 9.2, 9.3, 9.4, 9.5_

- [x] 18. データバックアップとストレージ管理
  - Google Cloud StorageまたはGitHubへの定期バックアップ
  - ファイル同期システム
  - データ整合性チェック
  - バックアップ復旧機能
  - _要件: 11.8_

- [x] 19. Google Cloud Run最適化
  - Dockerfileの作成とコンテナ最適化
  - コールドスタート時間の最小化
  - メモリ使用量最適化
  - 並行処理の実装
  - Cloud Run設定ファイル作成
  - _要件: 11.1, 11.3, 11.4_

- [x] 20. 監視とログシステム
  - 構造化ログの実装
  - Cloud Run使用量監視
  - API使用量ダッシュボード
  - 月次使用量警告システム（80%到達時）
  - パフォーマンスメトリクス収集
  - _要件: 10.1, 10.2, 11.9_

- [x] 21. セキュリティ実装
  - Google Cloud Secret Manager統合
  - 環境変数による機密情報管理
  - 認証情報の安全な保存
  - アクセスログ記録
  - _要件: 11.5, 11.6_

- [x] 22. 統合テストとエラー処理
  - 完全なメッセージ処理フローのテスト
  - API制限時の動作テスト
  - 音声処理フローのテスト
  - Garmin連携テスト
  - エラー復旧機能のテスト
  - _要件: 全要件の統合テスト_

- [x] 23. デプロイメント準備
  - Cloud Run用の設定ファイル作成
  - 環境変数設定ガイド
  - デプロイメントスクリプト作成
  - 初回セットアップ手順書作成
  - _要件: 11.1, 11.2_

- [x] 24. 家計管理システムの基盤実装
  - 06_Finance/フォルダ構造の作成
  - 定期購入サービス管理クラスの実装
  - 支払いスケジューラーの基本機能
  - 定期購入データモデルの実装
  - _要件: 12.1, 12.2, 12.3_

- [x] 25. 定期購入管理コマンドの実装
  - /sub_addコマンドの実装（サービス登録）
  - /sub_paidコマンドの実装（支払い完了報告）
  - /sub_listコマンドの実装（サービス一覧表示）
  - /sub_statsコマンドの実装（統計情報表示）
  - 定期購入ファイルのMarkdown生成機能
  - _要件: 12.2, 12.5, 12.6, 12.7_

- [x] 26. 定期購入リマインダーシステム
  - 毎日朝8時の支払い予定チェック機能
  - 3日以内支払い予定の通知システム
  - 支払い遅延リマインダー（3日経過後）
  - 💰 FINANCEカテゴリの#moneyチャンネル通知
  - _要件: 12.4, 12.8_

- [x] 27. 定期購入状態管理機能
  - /sub_pauseコマンド（一時停止）
  - /sub_resumeコマンド（再開）
  - /sub_cancelコマンド（キャンセル）
  - 支払い履歴の記録と次回日程自動計算
  - _要件: 12.9, 12.5_

- [x] 28. 一般的な収支管理機能
  - #expensesチャンネルでの支出記録機能
  - #incomeチャンネルでの収入記録機能
  - デイリーノートへの収支自動追記
  - 支出・収入データの構造化保存
  - _要件: 12.13, 12.14, 12.15_

- [x] 29. 予算管理システム
  - /budget_setコマンドの実装
  - カテゴリ別予算設定機能
  - 予算80%到達時の警告システム
  - /finance_statsコマンドの実装（収支バランス表示）
  - _要件: 12.16, 12.17_

- [x] 30. 家計レポート生成機能
  - 月次定期購入レポート（Gemini API使用）
  - 全体的な家計レポート生成
  - コスト最適化提案機能
  - 💰 FINANCEカテゴリの#reportsチャンネル送信
  - _要件: 12.10, 12.18_

- [x] 31. タスク管理システムの基盤実装
  - 07_Tasks/フォルダ構造の作成
  - タスク管理クラスの実装
  - タスクデータモデルの実装
  - タスクスケジューラーの基本機能
  - _要件: 13.1, 13.2, 13.3_

- [x] 32. タスク管理コマンドの実装
  - /task_addコマンドの実装（タスク作成）
  - /task_updateコマンドの実装（進捗更新）
  - /task_doneコマンドの実装（完了報告）
  - /task_listコマンドの実装（アクティブタスク一覧）
  - タスクファイルのMarkdown生成機能
  - _要件: 13.2, 13.5, 13.6, 13.7_

- [x] 33. タスクリマインダーシステム
  - 毎日朝8時の期限チェック機能
  - 期限3日以内・期限切れタスクの通知
  - 📋 TASKSカテゴリの#task-remindersチャンネル通知
  - デイリーノートへのタスク情報自動追記
  - _要件: 13.4, 13.11_

- [x] 34. スケジュール管理機能
  - /schedule_addコマンドの実装
  - スケジュールファイルの生成機能
  - 当日・翌日イベントの通知システム
  - 📋 TASKSカテゴリの#schedule-remindersチャンネル通知
  - _要件: 13.8, 13.9, 13.10_

- [x] 35. タスク統計とレポート機能
  - /task_statsコマンドの実装
  - タスク完了率・平均完了時間の計算
  - 優先度別統計の生成
  - 月次タスク・スケジュール管理レポート（Gemini API使用）
  - 📋 TASKSカテゴリの#task-summaryチャンネル送信
  - _要件: 13.12, 13.13_

- [x] 36. 家計・タスク管理テンプレート作成
  - 99_Meta/に定期購入サービス用テンプレート作成
  - 99_Meta/にタスク・スケジュール用テンプレート作成
  - テンプレート適用機能の実装
  - 一貫したフォーマットでのファイル生成
  - _要件: 12.12, 13.14_

- [x] 37. 家計・タスク管理統合テスト
  - 定期購入管理フローの完全テスト
  - タスク・スケジュール管理フローの完全テスト
  - リマインダーシステムの動作確認
  - レポート生成機能のテスト
  - Discord通知システムのテスト

- [x] 38. 最終統合とドキュメント
  - 全機能の統合テスト
  - ユーザーマニュアル作成
  - トラブルシューティングガイド
  - パフォーマンス最適化の最終調整
  - 本番環境での動作確認
  - _要件: 全要件の最終確認_
